<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Editor de Configurações da Wiki (Admin)</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      display: flex;
      justify-content: center;
      padding: 30px;
    }
    .container {
      background: white;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      max-width: 700px;
      width: 100%;
    }
    h1, h2 {
      text-align: center;
      color: #0056b3;
    }
    .form-group {
      margin-bottom: 16px;
    }
    label {
      font-weight: bold;
    }
    input[type="text"],
    input[type="email"],
    input[type="password"],
    input[type="color"] {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      margin-top: 5px;
    }
    button {
      padding: 12px;
      width: 100%;
      border: none;
      border-radius: 5px;
      background-color: #007bff;
      color: white;
      font-size: 16px;
      margin-top: 10px;
      cursor: pointer;
    }
    button:hover {
      background-color: #0056b3;
    }
    .secondary-button {
      background-color: #6f42c1;
    }
    .secondary-button:hover {
      background-color: #5a359f;
    }
    .error-message {
      color: red;
      text-align: center;
      margin-top: 10px;
    }
    #output {
      background: #eee;
      padding: 10px;
      border-radius: 5px;
      margin-top: 15px;
      font-family: monospace;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>Admin WZZM</h1>

  <div id="auth-section">
    <h2>Login</h2>
    <div class="form-group">
      <label for="email">Email</label>
      <input type="email" id="email" placeholder="admin@exemplo.com">
    </div>
    <div class="form-group">
      <label for="password">Senha</label>
      <input type="password" id="password" placeholder="••••••••">
    </div>
    <button id="loginButton">Entrar</button>
    <p id="authError" class="error-message"></p>
  </div>

  <div id="editor-section" style="display: none;">
    <p>Bem-vindo, <span id="currentUserEmail"></span>! <button id="logoutButton" style="background-color: #dc3545;">Sair</button></p>

    <div class="form-group">
      <label for="documentIdInput">ID do site (ex: wzzm.org):</label>
      <input type="text" id="documentIdInput" placeholder="dominio do site">
    </div>

    <button id="addMenuItemsButton" class="secondary-button">Inserir MenuConfig Padrão</button>
    <p id="docMessage" class="error-message" style="color: green;"></p>

    <div id="output">Aguardando ação...</div>
  </div>
</div>

<script>
  // Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyB9GkSqTIZ0kbVsba_WOdQeVAETrF9qna0",
    authDomain: "wzzm-ce3fc.firebaseapp.com",
    projectId: "wzzm-ce3fc",
    storageBucket: "wzzm-ce3fc.appspot.com",
    messagingSenderId: "249427877153",
    appId: "1:249427877153:web:0e4297294794a5aadeb260"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  const authSection = document.getElementById('auth-section');
  const editorSection = document.getElementById('editor-section');
  const emailInput = document.getElementById('email');
  const passwordInput = document.getElementById('password');
  const loginButton = document.getElementById('loginButton');
  const logoutButton = document.getElementById('logoutButton');
  const authError = document.getElementById('authError');
  const currentUserEmailSpan = document.getElementById('currentUserEmail');
  const addMenuItemsButton = document.getElementById('addMenuItemsButton');
  const documentIdInput = document.getElementById('documentIdInput');
  const docMessage = document.getElementById('docMessage');
  const outputDiv = document.getElementById('output');

  function cleanDocId(id) {
    if (!id) return '';
    let cleanedId = id.trim().toLowerCase();
    if (cleanedId.startsWith('www.')) {
      cleanedId = cleanedId.substring(4);
    }
    return cleanedId.split('/')[0].split(':')[0];
  }

  // Login
  loginButton.addEventListener('click', async () => {
    const email = emailInput.value;
    const password = passwordInput.value;
    authError.textContent = '';
    if (!email || !password) {
      authError.textContent = 'Preencha o e-mail e a senha.';
      return;
    }

    try {
      await auth.signInWithEmailAndPassword(email, password);
    } catch (error) {
      console.error("Erro ao logar:", error);
      authError.textContent = 'Erro ao fazer login.';
    }
  });

  logoutButton.addEventListener('click', async () => {
    try {
      await auth.signOut();
    } catch (error) {
      console.error("Erro ao sair:", error);
    }
  });

  auth.onAuthStateChanged(user => {
    if (user) {
      authSection.style.display = 'none';
      editorSection.style.display = 'block';
      currentUserEmailSpan.textContent = user.email;
    } else {
      authSection.style.display = 'block';
      editorSection.style.display = 'none';
      documentIdInput.value = '';
      outputDiv.textContent = 'Aguardando ação...';
    }
  });

  const menuItems = [
    {
      "label": "Video oficial recente",
      "href": "./vids/",
      "requiresAuth": false
    },
    {
      "label": "Transparência",
      "href": "./transparencia/",
      "requiresAuth": false
    }
  ];

  addMenuItemsButton.addEventListener('click', async () => {
    const idsite = cleanDocId(documentIdInput.value);

    if (!idsite) {
      docMessage.textContent = 'Digite um ID válido (domínio) para usar como "idsite".';
      docMessage.style.color = 'red';
      return;
    }

    let sucesso = 0;
    let falha = 0;

    for (const item of menuItems) {
      try {
        await db.collection("menuconfig").add({
          ...item,
          idsite: idsite
        });
        sucesso++;
      } catch (error) {
        console.error("Erro ao adicionar item:", item, error);
        falha++;
      }
    }

    docMessage.textContent = `Itens adicionados: ${sucesso}, falhas: ${falha}.`;
    docMessage.style.color = falha === 0 ? 'green' : 'orange';
    outputDiv.textContent = JSON.stringify(menuItems.map(m => ({ ...m, idsite })), null, 2);
  });
</script>
</body>
</html>
